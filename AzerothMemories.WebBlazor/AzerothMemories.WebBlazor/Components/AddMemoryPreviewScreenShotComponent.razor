@if (UploadedImage == null)
{

}
else
{
    var timeStr = "Unknown";
    if (UploadedImage.FileTimeStamp > 0)
    {
        timeStr = Services.TimeProvider.GetTimeAsLocalStringAgo(UploadedImage.FileTimeStamp, false);
    }

    <MudCard Class="pa-2 ma-2 card" Outlined="true" Elevation="10">
        <MudCardHeader>
            <CardHeaderContent>
                <MudText Typo="Typo.h6">@UploadedImage.FileName</MudText>
                <MudText Typo="Typo.body1">@timeStr</MudText>
            </CardHeaderContent>
            <CardHeaderActions>
                <MudTooltip Text="Delete" Color="Color.Dark">
                    <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" Disabled="@(Index == 0)" />
                </MudTooltip>
            </CardHeaderActions>
        </MudCardHeader>
        <MudCardContent>
            @{
                var id = $"imageBox-{Index}";
                <img id="@id" style="width: 100%; height: auto; object-fit: cover;" />
            }
        </MudCardContent>
    </MudCard>
}

@code {

    [Parameter, EditorRequired] public int Index { get; init; }
    [Parameter, EditorRequired] public IMoaServices Services { get; init; }
    [Parameter, EditorRequired] public AddMemoryUploadResult UploadedImage { get; init; }
    
    [Inject] public IJSRuntime JsRuntime { get; init; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await base.OnAfterRenderAsync(firstRender);

        if (firstRender)
        {
            await JsRuntime.InvokeVoidAsync("SetImage", $"imageBox-{Index}", UploadedImage.ContentType, UploadedImage.FileContent);
        }
    }

    protected override bool ShouldRender()
    {
        return false;
    }
}
