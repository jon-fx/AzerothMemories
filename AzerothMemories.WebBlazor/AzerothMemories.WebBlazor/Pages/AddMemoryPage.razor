@page "/addmemory/"
@inherits MoaComponentBase<AddMemoryPageViewModel>

<AuthorizeView>
    <Authorized>
        @if (ViewModel == null)
        {
        }
        else if (ViewModel.UploadedImages.Count > 0)
        {
            <AddMemoryComponent Services="@this" ViewModel="@ViewModel" OnPostMemoryResult="@OnPostMemoryCallback" />
        }
        else
        {
            <InputFile id="fileInput" OnChange="ViewModel.Initialize" hidden multiple accept=".jpg, .jpeg, .png" />
            <MudButton HtmlTag="label" Variant="Variant.Filled" FullWidth="true" Color="Color.Primary" IconColor="Color.Secondary" StartIcon="@Icons.Filled.CloudUpload" for="fileInput">Upload Image</MudButton>
        }
    </Authorized>
</AuthorizeView>

@code
{
    private async Task OnPostMemoryCallback(AddMemoryResult result)
    {
        if (result.Result == AddMemoryResultCode.Success)
        {                                                                                                                   
            NavigationManager.NavigateTo($"post/{result.AccountId}/{result.PostId}");
        }
        else if (result.Result == AddMemoryResultCode.Canceled)
        {
        }
        else
        {
            await DialogService.ShowNotificationDialog(false, $"{result.Result}");
        }

        StateHasChanged();
    }
}