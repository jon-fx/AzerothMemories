@page "/addmemory/"
@inherits MoaComponentBase<AddMemoryPageViewModel>

<AuthorizeView>
    <Authorized>
        @if (ViewModel == null)
        {
        }
        else if (ViewModel.UploadedImages.Count > 0)
        {
            <AddMemoryComponent Services="@this" ViewModel="@ViewModel" OnPostMemoryResult="@OnPostMemoryCallback" />
        }
        else
        {
            <InputFile id="fileInput" OnChange="ViewModel.Initialize" hidden multiple accept=".jpg, .jpeg, .png" />
            <MudButton HtmlTag="label" Variant="Variant.Filled" FullWidth="true" Color="Color.Primary" IconColor="Color.Secondary" StartIcon="@Icons.Filled.CloudUpload" for="fileInput">Upload Image</MudButton>
        }
    </Authorized>
</AuthorizeView>

@code
{
    private Task OnPostMemoryCallback(AddMemoryResult result)
    {
        //_addMemoryResult = result.Result;
        //_isMemoryVisible = false;

        if (result.Result == AddMemoryResultCode.Success)
        {                                                                                                                   
            NavigationManager.NavigateTo($"post/{result.AccountId}/{result.PostId}");
        }
        else if (result.Result == AddMemoryResultCode.Canceled)
        {
            //_uploadResults = null;
        }

        StateHasChanged();

        return Task.CompletedTask;
    }
}