@page "/post/{Id:long}/{PostId:long}"
@page "/post/{Name}/{PostId:long}"
@inherits MoaComponentBase<PostPageViewModel>

@if (!string.IsNullOrWhiteSpace(ViewModel.ErrorMessage))
{
    <CardErrorComponent ErrorMessage="@ViewModel.ErrorMessage" />
}
else if ( ViewModel.AccountViewModel == null || ViewModel.PostViewModel == null )
{
    <CardLoadingComponent />
}
else
{
    <PageTitle>@ViewModel.AccountViewModel.GetDisplayName()'s Memory of Azeroth</PageTitle>
    <AccountHeaderCardComponent Services="@this" AccountViewModel="@ViewModel.AccountViewModel" />
    <PostViewComponent Services="@this" Post="@ViewModel.PostViewModel" PostComments="@ViewModel.PostCommentPageViewModel"/>
}

@code 
{
    [Parameter, EditorRequired] public long Id { get; set; }

    [Parameter, EditorRequired] public long PostId { get; set; }

    [Parameter, EditorRequired] public string Name { get; set; }

    [Parameter, SupplyParameterFromQuery(Name = "page")] public string CurrentPage { get; init; }

    [Parameter, SupplyParameterFromQuery(Name = "comment")] public string FocusedCommentId { get; init; }

    protected override async Task ComputeStateOnParametersChanged()
    {
        await base.ComputeStateOnParametersChanged();

        ViewModel.OnParametersChanged(Id, Name, PostId, CurrentPage, FocusedCommentId);
    }
}